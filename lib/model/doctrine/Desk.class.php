<?php

/**
 * Desk
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 * 
 * @package    marcel
 * @subpackage model
 * @author     Dziamid
 * @version    SVN: $Id: Builder.php 7490 2010-03-29 19:53:27Z jwage $
 */
class Desk extends BaseDesk
{
  /**
  * Returs bills currently opened on the table (usually one)
  *
  */
  public function getOpenBills()
  {
    $q = Doctrine::getTable('Bill')
      ->createQuery('b')
      ->leftJoin('b.Items i')
      ->leftJoin('i.MenuItem m')
      ->leftJoin('m.Group')
      ->where('b.open = ?', true)
      ->andWhere('b.desk_id = ?', $this->getId())
      ->orderBy('i.created_at');
    
    return $q->execute();
  }
  /**
  * Add an open bill to a table
  *
  */
  public function open()
  {
    $bill = new Bill();
    $bill->setOpen(true);
    $bill->setDesk($this);
    $bill->save();
  }
  /**
  * Desk has open bills ?
  *
  */
  public function isOpen()
  {
    $bills = $this->getBills();
    foreach ($bills as $bill)
    {
      if ($bill->getOpen())
      {
        return true;
      }
    }
    return false;
  }

}

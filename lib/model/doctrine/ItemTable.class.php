<?php

/**
 * ItemTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class ItemTable extends Doctrine_Table
{
    /**
     * Returns an instance of this class.
     *
     * @return object ItemTable
     */
    public static function getInstance()
    {
        return Doctrine_Core::getTable('Item');
    }
    public function getItems($query)
    {
      $q = $this->createQuery('i')
        ->select('i.*, m.*, g.*, b.*')
        ->addSelect('(i.price * i.quantity) as total')
        ->leftJoin('i.MenuItem m')
        ->leftJoin('m.Group g')
        ->leftJoin('i.Bill b');
      return $q;
    }
    public function getGroupedByMenuItem()
    {
      $q = $this->createQuery('i')
        ->select('i.*')
        ->addSelect('SUM(i.quantity) as total_quantity')
        ->addSelect('SUM(i.quantity * i.price) as total_sum')
        ->addSelect('g.type as type')
        ->addSelect('m.name as name')
        ->groupBy('i.menu_item_id, i.price')
        ->leftJoin('i.MenuItem m')
        ->leftJoin('m.Group g')
        ->leftJoin('i.Bill b');

      return $q;
    }
    
    public function getGroupedByMenuItemCount($query)
    {
      $q = $this->createQuery('i')
        ->groupBy('i.menu_item_id, i.price');

      return $q;
    }
}